<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EchoScope — 反射測定（最小構成）</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <h1>EchoScope — 反射測定（ホワイトノイズ短パルス + 手動 t₁/t₂）</h1>
    <p>短いホワイトノイズのパルスを<b>発音</b>して録音。波形上をクリックして <b>t₁（直音ピーク）</b> と <b>t₂（反射ピーク）</b> を<b>手動で記録</b>します。</p>
  </header>

  <section class="panel">
    <div class="row">
      <label>録音時間 (ms)
        <input id="recMs" type="number" min="200" step="50" value="1200">
      </label>
      <label>プレロール (ms) <span class="hint">発音の何ms前から録音するか</span>
        <input id="preMs" type="number" min="50" step="10" value="150">
      </label>
      <label>パルス長 (ms)
        <input id="pulseMs" type="number" min="2" step="1" value="15">
      </label>
      <label>パルス音量 (0〜1)
        <input id="pulseVol" type="number" min="0" max="1" step="0.05" value="0.8">
      </label>
    </div>

    <div class="row">
      <button id="measureBtn">発音して測定</button>
      <button id="startBtn">録音のみ</button>
      <button id="stopBtn" disabled>停止</button>
      <button id="pulseTest">パルス再生テスト</button>
      <button id="exportBtn" disabled>CSV書き出し</button>
      <span id="status">準備OK</span>
    </div>
  </section>

  <section class="canvas-wrap">
    <canvas id="wave" width="1200" height="280" title="t₁/t₂ボタンを押してから、波形をクリックしてピーク位置を決めます"></canvas>
  </section>

  <section class="row">
    <button id="setT1">t₁手動</button>
    <button id="setT2">t₂手動</button>
    <button id="clearMarks">マーク消去</button>
  </section>

  <section class="results">
    <div>サンプルレート: <span id="sr">—</span> Hz</div>
    <div>t₁: <span id="t1">—</span> s ／ A₁: <span id="a1">—</span></div>
    <div>t₂: <span id="t2">—</span> s ／ A₂: <span id="a2">—</span></div>
    <div>Δt = <span id="dt">—</span> s</div>
  </section>

  <footer>
    <small>iPhoneでは録音中の再生音が小さく聞こえることがあります（無音ではありません）。聞こえにくい場合は「録音のみ」で手拍子等のパルスを使ってください。</small>
  </footer>

  <script src="script.js"></script>
</body>
</html>
